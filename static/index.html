<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>黄金交易市场监控与投资建议系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        secondary: '#3B82F6',
                        success: '#10B981',
                        danger: '#EF4444',
                        neutral: '#64748B',
                        'neutral-light': '#F1F5F9',
                        'neutral-dark': '#1E293B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .shadow-card {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            }
            .transition-smooth {
                transition: all 0.3s ease-in-out;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .bg-gradient-blue {
                background: linear-gradient(135deg, #1E40AF 0%, #3B82F6 100%);
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-4 md:mb-0">
                <i class="fa fa-line-chart text-primary text-3xl mr-3"></i>
                <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-gray-800">
                    黄金<span class="text-primary">交易市场</span>监控系统
                </h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-sm text-gray-500 hidden md:block">
                    <span id="last-update">最后更新: 加载中...</span>
                </div>
                <div class="px-4 py-2 bg-primary text-white rounded-md flex items-center transition-smooth hover:bg-primary/90">
                    <i class="fa fa-refresh mr-2" id="refresh-icon"></i>
                    <span>实时监控</span>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8">
        <!-- 价格展示面板 -->
        <section class="mb-8">
            <div class="bg-white rounded-xl shadow-card p-6 transition-smooth hover:shadow-lg">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-700 mb-2">黄金实时价格</h2>
                        <div class="flex items-center">
                            <span class="text-4xl font-bold mr-4" id="current-price">--</span>
                            <div class="flex flex-col">
                                <div class="flex items-center">
                                    <span id="price-change" class="text-lg font-medium">--</span>
                                    <span class="ml-1 text-sm text-gray-500">USD/盎司</span>
                                </div>
                                <span class="text-sm text-gray-500">开盘价: <span id="open-price">--</span></span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 md:mt-0 bg-gray-100 rounded-lg p-4">
                        <h3 class="text-sm font-semibold text-gray-600 mb-2">今日黄金市场概览</h3>
                        <div class="flex flex-wrap gap-4">
                            <div class="text-center">
                                <p class="text-xs text-gray-500">最高价</p>
                                <p class="font-semibold text-danger" id="high-price">--</p>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-500">最低价</p>
                                <p class="font-semibold text-success" id="low-price">--</p>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-500">波动幅度</p>
                                <p class="font-semibold text-primary" id="volatility">--</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 价格走势图 -->
                <div class="h-[400px] w-full">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
        </section>

        <!-- 市场信息和投资建议 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 三大市场信息 -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-card p-6 transition-smooth hover:shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">三大黄金交易市场</h2>
                    <div class="space-y-4">
                        <div class="p-4 border border-gray-100 rounded-lg bg-gray-50 hover:bg-gray-100 transition-smooth">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-medium">伦敦金市</h3>
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">当前开放</span>
                            </div>
                            <p class="text-sm text-gray-500 mb-1">交易时间: 16:30 - 00:30 (GMT+8)</p>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">LBMA 黄金价格</span>
                                <span class="font-semibold" id="london-price">--</span>
                            </div>
                        </div>

                        <div class="p-4 border border-gray-100 rounded-lg bg-gray-50 hover:bg-gray-100 transition-smooth">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-medium">纽约金市</h3>
                                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">当前开放</span>
                            </div>
                            <p class="text-sm text-gray-500 mb-1">交易时间: 20:20 - 03:30 (GMT+8)</p>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">COMEX 黄金期货</span>
                                <span class="font-semibold" id="newyork-price">--</span>
                            </div>
                        </div>

                        <div class="p-4 border border-gray-100 rounded-lg bg-gray-50 hover:bg-gray-100 transition-smooth">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-medium">上海金市</h3>
                                <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">当前开放</span>
                            </div>
                            <p class="text-sm text-gray-500 mb-1">交易时间: 09:00 - 11:30, 13:30 - 15:30 (GMT+8)</p>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">上海黄金交易所</span>
                                <span class="font-semibold" id="shanghai-price">--</span>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">
                                <span id="shanghai-change">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 投资建议 -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-card p-6 transition-smooth hover:shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">
                        <i class="fa fa-lightbulb-o text-yellow-500 mr-2"></i>AI 投资建议
                    </h2>
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-lg border border-blue-100">
                        <div class="flex items-start">
                            <div class="bg-blue-100 p-3 rounded-full mr-4">
                                <i class="fa fa-robot text-primary text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800 mb-2">市场分析与投资建议</h3>
                                <p class="text-gray-700 leading-relaxed" id="investment-advice">
                                    <i class="fa fa-spinner fa-spin mr-2"></i>正在分析市场数据，请稍候...
                                </p>
                                <div class="mt-4 flex flex-wrap gap-2">
                                    <span class="text-xs bg-green-100 text-green-800 px-3 py-1 rounded-full">技术分析</span>
                                    <span class="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full">基本面分析</span>
                                    <span class="text-xs bg-purple-100 text-purple-800 px-3 py-1 rounded-full">AI 推荐</span>
                                    <span class="text-xs bg-gray-100 text-gray-800 px-3 py-1 rounded-full">实时更新</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-medium text-gray-700 mb-2">风险提示</h4>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li class="flex items-start">
                                    <i class="fa fa-exclamation-circle text-warning mt-1 mr-2"></i>
                                    <span>黄金市场受多种因素影响，价格波动较大</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fa fa-exclamation-circle text-warning mt-1 mr-2"></i>
                                    <span>投资有风险，入市需谨慎</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fa fa-exclamation-circle text-warning mt-1 mr-2"></i>
                                    <span>建议根据个人风险承受能力制定投资策略</span>
                                </li>
                            </ul>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-medium text-gray-700 mb-2">投资工具推荐</h4>
                            <div class="grid grid-cols-3 gap-2 text-center">
                                <div class="p-2 bg-white rounded border border-gray-200">
                                    <p class="text-xs text-gray-500">实物黄金</p>
                                    <i class="fa fa-diamond text-yellow-500 text-lg mt-1"></i>
                                </div>
                                <div class="p-2 bg-white rounded border border-gray-200">
                                    <p class="text-xs text-gray-500">黄金ETF</p>
                                    <i class="fa fa-exchange text-blue-500 text-lg mt-1"></i>
                                </div>
                                <div class="p-2 bg-white rounded border border-gray-200">
                                    <p class="text-xs text-gray-500">黄金期货</p>
                                    <i class="fa fa-area-chart text-green-500 text-lg mt-1"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-sm text-gray-400">© 2023 黄金交易市场监控与投资建议系统</p>
                    <p class="text-xs text-gray-500 mt-1">本系统仅供学习参考，不构成投资建议</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="text-gray-400 hover:text-white transition-smooth">
                        <i class="fa fa-question-circle mr-1"></i>帮助中心
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-smooth">
                        <i class="fa fa-info-circle mr-1"></i>关于我们
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition-smooth">
                        <i class="fa fa-shield mr-1"></i>隐私政策
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- 通知弹窗 -->
    <div id="notification" class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 transform translate-y-20 opacity-0 transition-all duration-300 flex items-center max-w-xs z-50">
        <div id="notification-icon" class="mr-3 text-lg"></div>
        <div>
            <h4 class="font-medium text-gray-800" id="notification-title"></h4>
            <p class="text-sm text-gray-600" id="notification-message"></p>
        </div>
        <button class="ml-auto text-gray-400 hover:text-gray-600" onclick="hideNotification()">
            <i class="fa fa-times"></i>
        </button>
    </div>

    <script>
        // 初始化图表
        let priceChart;
        let priceData = [];
        let timeLabels = [];
        
        function initChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timeLabels,
                    datasets: [{
                        label: '黄金价格 (USD/盎司)',
                        data: priceData,
                        borderColor: '#1E40AF',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        pointBackgroundColor: '#3B82F6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 41, 59, 0.9)',
                            padding: 12,
                            titleFont: {
                                size: 14
                            },
                            bodyFont: {
                                size: 13
                            },
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return `价格: $${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#64748B',
                                font: {
                                    size: 11
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(226, 232, 240, 0.5)'
                            },
                            ticks: {
                                color: '#64748B',
                                font: {
                                    size: 11
                                },
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        // 更新价格数据
        function updatePriceData(data) {
            // 更新主价格显示（伦敦金）
            document.getElementById('current-price').textContent = `$${data.current_price.toFixed(2)}`;
            document.getElementById('open-price').textContent = `$${data.open_price.toFixed(2)}`;
            
            // 设置价格颜色（高于开盘价红色，低于开盘价绿色）
            const priceElement = document.getElementById('current-price');
            const changeElement = document.getElementById('price-change');
            
            if (data.current_price > data.open_price) {
                priceElement.className = 'text-4xl font-bold mr-4 text-danger';
                changeElement.className = 'text-lg font-medium text-danger';
                changeElement.innerHTML = `<i class="fa fa-caret-up"></i> ${data.change_percent.toFixed(2)}%`;
            } else if (data.current_price < data.open_price) {
                priceElement.className = 'text-4xl font-bold mr-4 text-success';
                changeElement.className = 'text-lg font-medium text-success';
                changeElement.innerHTML = `<i class="fa fa-caret-down"></i> ${Math.abs(data.change_percent).toFixed(2)}%`;
            } else {
                priceElement.className = 'text-4xl font-bold mr-4';
                changeElement.className = 'text-lg font-medium';
                changeElement.innerHTML = `<i class="fa fa-minus"></i> 0.00%`;
            }
            
            // 更新最后更新时间
            const updateTime = new Date(data.last_update);
            document.getElementById('last-update').textContent = 
                `最后更新: ${updateTime.toLocaleString('zh-CN')}`;
            
            // 更新最高价、最低价和波动幅度（使用API返回的精确数据）
            document.getElementById('high-price').textContent = `$${data.high_price.toFixed(2)}`;
            document.getElementById('low-price').textContent = `$${data.low_price.toFixed(2)}`;
            
            // 计算波动幅度
            const volatility = ((data.high_price - data.low_price) / data.open_price * 100).toFixed(2);
            document.getElementById('volatility').textContent = `${volatility}%`;
            
            // 更新图表数据
            timeLabels = data.history.map(item => {
                const date = new Date(item.timestamp);
                return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            });
            
            priceData = data.history.map(item => item.price);
            
            if (priceChart) {
                priceChart.data.labels = timeLabels;
                priceChart.data.datasets[0].data = priceData;
                priceChart.update();
            }
            
            // 更新三大市场价格（使用真实数据）
            if (data.markets) {
                // 更新伦敦金
                updateMarketPrice('london-price', data.markets.london.current_price, data.markets.london.change_percent);
                
                // 更新纽约金
                updateMarketPrice('newyork-price', data.markets.newyork.current_price, data.markets.newyork.change_percent);
                
                // 更新上海金
                updateMarketPrice('shanghai-price', data.markets.shanghai.current_price, data.markets.shanghai.change_percent);
                
                // 更新上海金的涨跌幅显示
                const shanghaiChange = document.getElementById('shanghai-change');
                if (data.markets.shanghai.change_percent > 0) {
                    shanghaiChange.className = 'text-danger';
                    shanghaiChange.innerHTML = `<i class="fa fa-caret-up"></i> ${data.markets.shanghai.change_percent.toFixed(2)}%`;
                } else if (data.markets.shanghai.change_percent < 0) {
                    shanghaiChange.className = 'text-success';
                    shanghaiChange.innerHTML = `<i class="fa fa-caret-down"></i> ${Math.abs(data.markets.shanghai.change_percent).toFixed(2)}%`;
                } else {
                    shanghaiChange.className = 'text-gray-500';
                    shanghaiChange.innerHTML = `<i class="fa fa-minus"></i> 0.00%`;
                }
            }
        }
        
        // 更新单个市场价格显示
        function updateMarketPrice(elementId, price, changePercent) {
            const element = document.getElementById(elementId);
            element.textContent = `$${price.toFixed(2)}`;
            
            // 设置价格颜色
            if (changePercent > 0) {
                element.className = 'font-semibold text-danger';
            } else if (changePercent < 0) {
                element.className = 'font-semibold text-success';
            } else {
                element.className = 'font-semibold';
            }
        }

        // 获取投资建议
        function getInvestmentAdvice() {
            fetch('/api/investment-advice')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('investment-advice').textContent = data.advice;
                })
                .catch(error => {
                    console.error('获取投资建议失败:', error);
                    document.getElementById('investment-advice').textContent = 
                        '无法获取投资建议，请稍后重试';
                });
        }

        // 显示通知
        function showNotification(type, title, message) {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notification-icon');
            const titleEl = document.getElementById('notification-title');
            const messageEl = document.getElementById('notification-message');
            
            // 设置图标和样式
            if (type === 'success') {
                icon.className = 'mr-3 text-lg text-success';
                icon.innerHTML = '<i class="fa fa-check-circle"></i>';
            } else if (type === 'error') {
                icon.className = 'mr-3 text-lg text-danger';
                icon.innerHTML = '<i class="fa fa-exclamation-circle"></i>';
            } else if (type === 'warning') {
                icon.className = 'mr-3 text-lg text-yellow-500';
                icon.innerHTML = '<i class="fa fa-warning"></i>';
            } else {
                icon.className = 'mr-3 text-lg text-primary';
                icon.innerHTML = '<i class="fa fa-info-circle"></i>';
            }
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            // 显示通知
            notification.classList.remove('translate-y-20', 'opacity-0');
            notification.classList.add('translate-y-0', 'opacity-100');
            
            // 3秒后自动隐藏
            setTimeout(hideNotification, 3000);
        }

        // 隐藏通知
        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('translate-y-0', 'opacity-100');
            notification.classList.add('translate-y-20', 'opacity-0');
        }

        // 刷新按钮动画
        function animateRefreshButton() {
            const refreshIcon = document.getElementById('refresh-icon');
            refreshIcon.classList.add('fa-spin');
            setTimeout(() => {
                refreshIcon.classList.remove('fa-spin');
            }, 1000);
        }

        // 定期更新数据
        function startUpdatingData() {
            // 初始加载数据
            fetch('/api/gold-price')
                .then(response => response.json())
                .then(data => {
                    updatePriceData(data);
                    getInvestmentAdvice();
                    showNotification('success', '数据加载成功', '黄金价格监控已开始');
                })
                .catch(error => {
                    console.error('获取黄金价格失败:', error);
                    showNotification('error', '数据加载失败', '无法获取黄金价格数据，请稍后重试');
                });
            
            // 每5秒更新一次价格数据（严格按照需求）
            setInterval(() => {
                fetch('/api/gold-price')
                    .then(response => response.json())
                    .then(data => {
                        updatePriceData(data);
                    })
                    .catch(error => {
                        console.error('更新黄金价格失败:', error);
                    });
            }, 5000);
            
            // 每30秒更新一次投资建议（更合理的建议更新频率）
            setInterval(() => {
                getInvestmentAdvice();
            }, 30000);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            startUpdatingData();
            
            // 为刷新按钮添加点击事件
            document.querySelector('.bg-primary').addEventListener('click', function() {
                animateRefreshButton();
                fetch('/api/gold-price')
                    .then(response => response.json())
                    .then(data => {
                        updatePriceData(data);
                        getInvestmentAdvice();
                        showNotification('success', '刷新成功', '数据已更新');
                    })
                    .catch(error => {
                        showNotification('error', '刷新失败', '无法更新数据');
                    });
            });
        });
    </script>
</body>
</html>